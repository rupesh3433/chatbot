<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JinniChirag MUA â€” AI Assistant</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,500;1,400&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --rose:    #c9705a;
    --rose-lt: #f0d9d3;
    --gold:    #b8924a;
    --dark:    #1a1410;
    --mid:     #3d2e24;
    --bg:      #fdf8f5;
    --surface: #fff9f6;
    --border:  #e8ddd6;
    --text:    #2d1f17;
    --muted:   #8a7068;
    --radius:  14px;
    --shadow:  0 4px 24px rgba(30,15,5,.10);
  }

  html, body { height: 100%; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    width: 100%;
    background: linear-gradient(135deg, var(--dark) 0%, var(--mid) 100%);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 14px;
    box-shadow: 0 2px 16px rgba(0,0,0,.25);
    position: sticky; top: 0; z-index: 10;
  }
  .logo-ring {
    width: 46px; height: 46px; border-radius: 50%;
    background: linear-gradient(135deg, var(--rose), var(--gold));
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; flex-shrink: 0;
  }
  .brand h1 {
    font-family: 'Playfair Display', serif;
    font-size: 18px; color: #fff; font-weight: 500; letter-spacing: .3px;
  }
  .brand p { font-size: 12px; color: rgba(255,255,255,.55); margin-top: 1px; }
  .status-pill {
    margin-left: auto; display: flex; align-items: center; gap: 6px;
    background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12);
    border-radius: 20px; padding: 5px 12px; font-size: 12px; color: rgba(255,255,255,.7);
  }
  .status-dot {
    width: 7px; height: 7px; border-radius: 50%; background: #4ade80;
    animation: pulse-dot 2s infinite;
  }
  .status-dot.offline { background: #f87171; animation: none; }
  @keyframes pulse-dot { 0%,100%{opacity:1} 50%{opacity:.4} }

  /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .container {
    width: 100%; max-width: 780px;
    display: flex; flex-direction: column; height: calc(100vh - 78px);
  }

  /* â”€â”€ Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #messages {
    flex: 1; overflow-y: auto; padding: 24px 20px;
    display: flex; flex-direction: column; gap: 20px;
    scroll-behavior: smooth;
  }
  #messages::-webkit-scrollbar { width: 5px; }
  #messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

  /* â”€â”€ Bubble â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .msg { display: flex; gap: 10px; max-width: 88%; animation: slide-in .25s ease; }
  @keyframes slide-in { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }
  .msg.user   { align-self: flex-end; flex-direction: row-reverse; }
  .msg.bot    { align-self: flex-start; }

  .avatar {
    width: 34px; height: 34px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0; margin-top: 2px;
  }
  .msg.user .avatar { background: linear-gradient(135deg, var(--rose), var(--gold)); color:#fff; }
  .msg.bot  .avatar { background: linear-gradient(135deg, var(--dark), var(--mid)); color:#fff; }

  .bubble {
    padding: 13px 16px; border-radius: var(--radius);
    line-height: 1.65; font-size: 14.5px;
    box-shadow: var(--shadow);
  }
  .msg.user .bubble {
    background: linear-gradient(135deg, var(--rose) 0%, #b05a42 100%);
    color: #fff; border-bottom-right-radius: 4px;
  }
  .msg.bot .bubble {
    background: var(--surface); color: var(--text);
    border: 1px solid var(--border); border-bottom-left-radius: 4px;
  }
  .bubble ul, .bubble ol { padding-left: 18px; margin: 6px 0; }
  .bubble li   { margin: 3px 0; }
  .bubble p    { margin: 4px 0; }
  .bubble a    { color: var(--rose); text-decoration: none; }
  .bubble a:hover { text-decoration: underline; }

  /* â”€â”€ Metadata row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .meta {
    display: flex; gap: 8px; margin-top: 5px; flex-wrap: wrap;
    align-items: center; padding-left: 44px;
  }
  .msg.user .meta { justify-content: flex-end; padding-left: 0; padding-right: 44px; }
  .badge {
    font-size: 11px; padding: 2px 9px; border-radius: 20px;
    font-weight: 500; letter-spacing: .2px;
  }
  .badge.emotion { background: var(--rose-lt); color: var(--rose); }
  .badge.llm     { background: #d1fae5; color: #065f46; }
  .badge.rule    { background: #fef3c7; color: #92400e; }
  .badge.src     { background: #e8ddd6; color: var(--mid); cursor: pointer; }
  .badge.src:hover { background: var(--rose-lt); }

  /* â”€â”€ Sources drawer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sources-drawer {
    margin-top: 6px; padding: 10px 14px;
    background: #fef9f6; border: 1px solid var(--border);
    border-radius: 10px; display: none; font-size: 12.5px;
    color: var(--muted); line-height: 1.6;
  }
  .sources-drawer.open { display: block; }
  .src-item { margin: 4px 0; padding: 5px 8px; background: #fff; border-radius: 7px;
              border-left: 3px solid var(--rose); }
  .src-title { font-weight: 600; color: var(--text); }
  .src-score { float: right; color: var(--gold); }
  .src-preview { color: var(--muted); margin-top: 2px; font-size: 12px; }

  /* â”€â”€ Typing indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .typing { display: flex; gap: 5px; align-items: center;
            padding: 12px 14px; }
  .dot { width: 8px; height: 8px; border-radius: 50%;
         background: var(--rose); opacity: .4;
         animation: bounce .9s infinite; }
  .dot:nth-child(2) { animation-delay: .2s; }
  .dot:nth-child(3) { animation-delay: .4s; }
  @keyframes bounce { 0%,60%,100%{transform:none;opacity:.4} 30%{transform:translateY(-5px);opacity:1} }

  /* â”€â”€ Input bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .input-area {
    padding: 14px 20px 18px;
    background: var(--surface);
    border-top: 1px solid var(--border);
  }
  .input-row {
    display: flex; gap: 10px; align-items: flex-end;
    background: #fff; border: 1.5px solid var(--border);
    border-radius: 16px; padding: 8px 10px 8px 16px;
    box-shadow: var(--shadow); transition: border-color .2s;
  }
  .input-row:focus-within { border-color: var(--rose); }
  #msg-input {
    flex: 1; border: none; outline: none; resize: none;
    font-family: inherit; font-size: 14.5px; color: var(--text);
    background: transparent; max-height: 120px; line-height: 1.5;
    padding: 4px 0;
  }
  #msg-input::placeholder { color: var(--muted); }
  #send-btn {
    width: 38px; height: 38px; border-radius: 12px; border: none; cursor: pointer;
    background: linear-gradient(135deg, var(--rose), #b05a42);
    color: #fff; font-size: 17px; display: flex; align-items: center;
    justify-content: center; flex-shrink: 0; transition: transform .15s, opacity .15s;
  }
  #send-btn:hover:not(:disabled) { transform: scale(1.07); }
  #send-btn:disabled { opacity: .4; cursor: not-allowed; }

  /* â”€â”€ Quick chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
  .chip {
    font-size: 12.5px; padding: 5px 13px; border-radius: 20px; cursor: pointer;
    border: 1.5px solid var(--border); background: #fff; color: var(--mid);
    transition: all .18s; font-family: inherit;
  }
  .chip:hover { border-color: var(--rose); color: var(--rose);
                background: var(--rose-lt); transform: translateY(-1px); }

  /* â”€â”€ Welcome card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .welcome {
    text-align: center; padding: 30px 20px 10px;
    animation: slide-in .4s ease;
  }
  .welcome-icon { font-size: 40px; margin-bottom: 12px; }
  .welcome h2 { font-family: 'Playfair Display', serif; font-size: 22px;
                color: var(--dark); margin-bottom: 6px; }
  .welcome p  { font-size: 14px; color: var(--muted); max-width: 380px; margin: 0 auto; }

  /* â”€â”€ Scrollbar for textarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #msg-input::-webkit-scrollbar { width: 4px; }
  #msg-input::-webkit-scrollbar-thumb { background: var(--border); }

  @media (max-width: 600px) {
    .msg { max-width: 96%; }
    .container { max-width: 100%; }
  }
</style>
</head>
<body>

<header>
  <div class="logo-ring">ğŸ’„</div>
  <div class="brand">
    <h1>JinniChirag Makeup Artist</h1>
    <p>AI Assistant â€” Powered by Local LLM</p>
  </div>
  <div class="status-pill">
    <div class="status-dot" id="status-dot"></div>
    <span id="status-text">Connectingâ€¦</span>
  </div>
</header>

<div class="container">
  <div id="messages">
    <div class="welcome">
      <div class="welcome-icon">âœ¨</div>
      <h2>Hello! How can I help?</h2>
      <p>Ask me anything about services, pricing, booking, or Chirag Sharma.</p>
    </div>
  </div>

  <div class="input-area">
    <div class="chips" id="chips">
      <button class="chip" onclick="send('What services do you offer?')">ğŸ’„ Services</button>
      <button class="chip" onclick="send('How much does bridal makeup cost?')">ğŸ’° Pricing</button>
      <button class="chip" onclick="send('How do I book an appointment?')">ğŸ“… Booking</button>
      <button class="chip" onclick="send('What is your phone number?')">ğŸ“ Contact</button>
      <button class="chip" onclick="send('Tell me about Chirag Sharma')">ğŸ‘¤ About</button>
      <button class="chip" onclick="send('Give me makeup tips')">âœ¨ Tips</button>
    </div>
    <div class="input-row">
      <textarea id="msg-input" rows="1" placeholder="Ask anything about JinniChirag Makeup Artistâ€¦"></textarea>
      <button id="send-btn" onclick="sendMessage()" title="Send">â¤</button>
    </div>
  </div>
</div>

<script>
  const SESSION_ID = 'session_' + Math.random().toString(36).slice(2, 11);
  const API        = window.location.origin;
  let isWaiting    = false;

  const msgsEl   = document.getElementById('messages');
  const inputEl  = document.getElementById('msg-input');
  const sendBtn  = document.getElementById('send-btn');
  const dotEl    = document.getElementById('status-dot');
  const statEl   = document.getElementById('status-text');

  // â”€â”€ Auto-resize textarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  inputEl.addEventListener('input', () => {
    inputEl.style.height = 'auto';
    inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';
  });
  inputEl.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });

  // â”€â”€ Health check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function checkHealth() {
    try {
      const r = await fetch(`${API}/health`);
      const d = await r.json();
      if (d.ollama_running && d.model_available) {
        dotEl.className = 'status-dot';
        statEl.textContent = d.model + ' ready';
      } else if (d.ollama_running) {
        dotEl.className = 'status-dot offline';
        statEl.textContent = 'Model not pulled';
      } else {
        dotEl.className = 'status-dot offline';
        statEl.textContent = 'Ollama offline';
      }
    } catch {
      dotEl.className = 'status-dot offline';
      statEl.textContent = 'Server offline';
    }
  }
  checkHealth();
  setInterval(checkHealth, 30000);

  // â”€â”€ Emotion â†’ emoji â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const EMOTION_EMOJI = {
    happy:'ğŸ˜Š', excited:'ğŸ‰', sad:'ğŸ’™', angry:'ğŸ˜¤', confused:'ğŸ¤”', neutral:'ğŸ˜'
  };

  // â”€â”€ Send â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function send(text) { inputEl.value = text; sendMessage(); }

  async function sendMessage() {
    const text = inputEl.value.trim();
    if (!text || isWaiting) return;

    isWaiting = true;
    sendBtn.disabled = true;
    inputEl.value = '';
    inputEl.style.height = 'auto';

    // User bubble
    appendMsg('user', text, null);

    // Typing indicator
    const typingId = appendTyping();

    try {
      const res = await fetch(`${API}/chat`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({session_id: SESSION_ID, message: text}),
      });
      const data = await res.json();
      removeEl(typingId);

      const em   = data.emotion_label || 'neutral';
      const conf = Math.round((data.emotion_confidence || 0) * 100);
      const emo  = `${EMOTION_EMOJI[em] || 'ğŸ’¬'} ${em} Â· ${conf}%`;

      appendMsg('bot', data.answer_text, {
        emotion:   emo,
        llm_used:  data.llm_used,
        sources:   data.top_chunks || [],
        intent:    data.intent_mode,
      });
    } catch (err) {
      removeEl(typingId);
      appendMsg('bot', 'âš ï¸ Connection error. Please check the server is running.', null);
    }

    isWaiting = false;
    sendBtn.disabled = false;
    inputEl.focus();
  }

  // â”€â”€ Render message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function appendMsg(role, text, meta) {
    const id  = 'msg_' + Date.now();
    const div = document.createElement('div');
    div.className = `msg ${role}`;
    div.id = id;

    const avatar = role === 'user' ? 'ğŸ‘¤' : 'ğŸ’„';
    const bubbleHtml = formatText(text);

    let metaHtml = '';
    if (meta && role === 'bot') {
      const llmBadge = meta.llm_used
        ? '<span class="badge llm">ğŸ¤– LLM</span>'
        : '<span class="badge rule">ğŸ“‹ Template</span>';
      const srcBadge = meta.sources.length
        ? `<span class="badge src" onclick="toggleSources('src_${id}')">ğŸ“„ ${meta.sources.length} source${meta.sources.length>1?'s':''}</span>`
        : '';
      metaHtml = `
        <div class="meta">
          <span class="badge emotion">${meta.emotion}</span>
          ${llmBadge}
          ${srcBadge}
        </div>`;

      if (meta.sources.length) {
        let srcItems = meta.sources.map(s => `
          <div class="src-item">
            <span class="src-title">ğŸ“ ${escHtml(s.title || 'Source')}</span>
            <span class="src-score">${(s.similarity*100).toFixed(1)}%</span>
            <div class="src-preview">${escHtml((s.preview||'').slice(0,100))}â€¦</div>
          </div>`).join('');
        metaHtml += `<div class="sources-drawer" id="src_${id}">${srcItems}</div>`;
      }
    }

    div.innerHTML = `
      <div class="avatar">${avatar}</div>
      <div>
        <div class="bubble">${bubbleHtml}</div>
        ${metaHtml}
      </div>`;

    msgsEl.appendChild(div);
    msgsEl.scrollTop = msgsEl.scrollHeight;
    return id;
  }

  function toggleSources(id) {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('open');
  }

  function appendTyping() {
    const id  = 'typing_' + Date.now();
    const div = document.createElement('div');
    div.className = 'msg bot'; div.id = id;
    div.innerHTML = `
      <div class="avatar">ğŸ’„</div>
      <div class="bubble"><div class="typing">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div></div>`;
    msgsEl.appendChild(div);
    msgsEl.scrollTop = msgsEl.scrollHeight;
    return id;
  }

  function removeEl(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
  }

  // â”€â”€ Text formatting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function formatText(text) {
    // Escape HTML
    let t = escHtml(text);
    // Bold **text**
    t = t.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    // Numbered lists
    t = t.replace(/^(\d+)\.\s+(.+)$/gm, '<li>$2</li>');
    if (t.includes('<li>')) {
      t = t.replace(/(<li>.*<\/li>\n?)+/gs, m => `<ol>${m}</ol>`);
    }
    // Bullet lists
    t = t.replace(/^[â€¢\-\*]\s+(.+)$/gm, '<li>$1</li>');
    if (/<li>/.test(t) && !/<ol>/.test(t)) {
      t = t.replace(/(<li>.*<\/li>\n?)+/gs, m => `<ul>${m}</ul>`);
    }
    // Line breaks
    t = t.replace(/\n{2,}/g, '</p><p>').replace(/\n/g, '<br>');
    return `<p>${t}</p>`;
  }

  function escHtml(s) {
    return String(s)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;').replace(/'/g,'&#39;');
  }
</script>
</body>
</html>